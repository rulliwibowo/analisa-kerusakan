{% extends "base.html" %} {% block title %}User Management{% endblock %} {%
block content %}
<div class="container mt-4 col-lg-12">
  <h2><i class="bi bi-people-fill"></i> User Management</h2>
  <p>This page displays a list of system users and their roles.</p>

  <div class="text-right mb-3">
    <button
      class="btn btn-primary btn-sm"
      data-toggle="modal"
      data-target="#addUserModal"
    >
      ‚ûï Add New User
    </button>
  </div>

  <div class="card shadow-sm mt-4">
    <div class="card-body">
      <h5 class="card-title">User List</h5>
      <div class="table-responsive">
        <table class="table table-bordered align-middle">
          <thead class="table-light">
            <tr>
              <th>Username</th>
              <th class="text-center">Role</th>
              <th class="text-center">Action</th>
            </tr>
          </thead>
          <tbody>
            {% for user in users %}
            <tr>
              <td>{{ user.username }}</td>
              <td class="text-center">
                {% if user.role == 'admin' %}
                <span class="badge badge-success">Admin</span>
                {% else %}
                <span class="badge badge-secondary">User</span>
                {% endif %}
              </td>
              <td class="text-center">
                <button
                  class="btn btn-sm btn-outline-warning btn-edit"
                  data-toggle="modal"
                  data-target="#editUserModal"
                  data-id="{{ user.id }}"
                  data-username="{{ user.username }}"
                  data-role="{{ user.role }}"
                >
                  ‚úèÔ∏è Edit
                </button>
                <button class="btn btn-sm btn-outline-danger disabled">
                  üóëÔ∏è Delete
                </button>
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>

<!-- Modal Tambah User -->
<div
  class="modal fade"
  id="addUserModal"
  tabindex="-1"
  role="dialog"
  aria-labelledby="addUserModalLabel"
  aria-hidden="true"
>
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <form action="{{ url_for('add_user') }}" method="POST">
        <div class="modal-header">
          <h5 class="modal-title" id="addUserModalLabel">Add New User</h5>
          <button
            type="button"
            class="close"
            data-dismiss="modal"
            aria-label="Close"
          >
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          <div class="form-group">
            <label>Username</label>
            <input
              type="text"
              name="username"
              class="form-control"
              placeholder="Enter username"
              required
            />
          </div>
          <div class="form-group">
            <label>Password</label>
            <input
              type="password"
              name="password"
              class="form-control"
              placeholder="Enter password"
              required
            />
          </div>
          <div class="form-group">
            <label>Role</label>
            <select name="role" class="form-control">
              <option value="user" selected>User</option>
              <option value="admin">Admin</option>
            </select>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-dismiss="modal">
            Cancel
          </button>
          <button type="submit" class="btn btn-primary">Save User</button>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- Modal Edit User -->
<div
  class="modal fade"
  id="editUserModal"
  tabindex="-1"
  role="dialog"
  aria-labelledby="editUserModalLabel"
  aria-hidden="true"
>
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <form id="editUserForm" method="POST">
        <!-- action diatur oleh JS -->
        <div class="modal-header">
          <h5 class="modal-title" id="editUserModalLabel">Edit User</h5>
          <button
            type="button"
            class="close"
            data-dismiss="modal"
            aria-label="Close"
          >
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          <div class="form-group">
            <label for="edit-username">Username</label>
            <input
              type="text"
              name="username"
              id="edit-username"
              class="form-control"
              required
            />
          </div>
          <div class="form-group">
            <label for="edit-password">New Password</label>
            <input
              type="password"
              name="password"
              id="edit-password"
              class="form-control"
              placeholder="Leave blank to keep current password"
            />
            <small class="form-text text-muted"
              >Leave this field empty if you don't want to change the
              password.</small
            >
          </div>
          <div class="form-group">
            <label for="edit-role">Role</label>
            <select name="role" id="edit-role" class="form-control">
              <option value="user">User</option>
              <option value="admin">Admin</option>
            </select>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-dismiss="modal">
            Cancel
          </button>
          <button type="submit" class="btn btn-primary">Save Changes</button>
        </div>
      </form>
    </div>
  </div>
</div>
{% endblock %} {% block scripts %}
<script>
  $(".btn-edit").on("click", function () {
    const userId = $(this).data("id");
    $("#editUserForm").attr("action", "/edit_user/" + userId);
    $("#edit-username").val($(this).data("username"));
    $("#edit-role").val($(this).data("role"));
    $('#editUserModal input[name="password"]').val(""); // Kosongkan field password saat modal dibuka
  });
</script>
{% endblock %}
